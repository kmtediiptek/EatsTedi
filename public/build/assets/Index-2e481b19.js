import{r as f,q as v,W as J,j as r,F as $,a as e,b as E,y as T}from"./app-081f3543.js";import{A as b}from"./Actionbutton-d06f7bce.js";import{C as L}from"./Container-9e3dc6e2.js";import"./Table-ee63abb5.js";import{A as H}from"./App-4fd9dbe3.js";import{n as s}from"./Helper-c43eaa91.js";import{A as z}from"./ActionLink-fdfbf142.js";import{T as C}from"./TextInput-b48b3dcc.js";import{S as M}from"./react-select.esm-dead390a.js";import{E as W}from"./jspdf.plugin.autotable-7ffd63b8.js";import{I as Y,a as G}from"./IconPrinter-3099a3ce.js";import"./index-f1485e47.js";import"./transition-cc3e1cad.js";import"./createReactComponent-10853b87.js";import"./defineProperty-4870f27f.js";import"./typeof-7fd5df1e.js";function U({products_sold:h,suppliers:Q,banyak_transaksi:p,total_qris:x,total_cash:N}){const[S,k]=f.useState(!1),{errors:u}=v().props,[P,q]=f.useState("all"),[F,V]=f.useState(""),{url:K}=v(),_=[...h].sort((a,t)=>new Date(t.purchased_at)-new Date(a.purchased_at)).reduce((a,t)=>{const{name:l}=t.product,m=t.supplier.name;a[l]||(a[l]={totalCash:0,totalQris:0,totalTransactionsCash:0,totalTransactionsQris:0,totalOmset:0,totalKomisi:0,totalQrisKomisi:0,totalOmsetBersih:0,price:t.product.price,supplierName:m});const n=t.invoice.payment.name,i=t.price*t.quantity,c=n==="qris"?i*.1:0,o=i-c;return a[l].totalCash+=n==="cash"?i:0,a[l].totalQris+=n==="qris"?i:0,a[l].totalTransactionsCash+=n==="cash"?t.quantity:0,a[l].totalTransactionsQris+=n==="qris"?t.quantity:0,a[l].totalOmset+=i,a[l].totalKomisi+=n==="qris"?c:0,a[l].totalQrisKomisi+=n==="qris"?c:0,a[l].totalOmsetBersih+=o,a},{}),D=()=>{T.get("/admin/laporan",{start_date:d.start_date,end_date:d.end_date},{preserveState:!0}),k(!0)},{data:d,setData:A,delete:Z}=J({start_date:"",end_date:""}),w=a=>{A(a.target.name,a.target.value)},O=a=>{try{const t=new W("landscape"),l=["No","Nama Penitip","Nama Produk","Harga Produk Satuan","Jumlah Pendapatan Cash","Jumlah Pendapatan Qris","Jumlah Transaksi Cash","Jumlah Transaksi Qris","Total Omset","Komisi 10%","Total Qris - Komisi","Omset Bersih","Tanggal Transaksi"],m=[];[...a].sort((i,c)=>new Date(c.purchased_at)-new Date(i.purchased_at)).forEach((i,c)=>{const o=i.price*i.quantity,y=i.invoice.payment.name==="qris"?o*.1:0,j=i.invoice.payment.name==="qris"?o-y:0,R=i.purchased_at?new Date(i.purchased_at).toLocaleString("id-ID",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-";m.push([c+1,i.supplier.name,i.product.name,s(i.price),i.invoice.payment.name==="cash"?s(o):"-",i.invoice.payment.name==="qris"?s(o):"-",i.invoice.payment.name==="cash"?i.quantity:"-",i.invoice.payment.name==="qris"?i.quantity:"-",s(o),s(y),s(j),s(o-y),R])}),t.autoTable({head:[l],body:m,startY:20}),t.addPage(),t.text("Informasi Tambahan:",14,20),t.text(`Total Rekap: ${s(p)}`,14,40),t.text(`Total Qris Kotor: ${s(x)}`,14,50),t.text(`Total Komisi Kantin (10%): ${s(p/10)}`,14,60),t.text(`Total Qris Bersih: ${s(x-p/10)}`,14,70),t.text(`Total Cash: ${s(N)}`,14,80),t.save("Laporan.pdf")}catch(t){console.error("Error generating PDF:",t)}},B=a=>{const t=a?a.value:"";q(t||"all"),T.get(K,{search:F,supplier:t},{preserveState:!0})},g=[{value:"all",label:"All Suppliers"},...Q.slice().sort((a,t)=>a.name.localeCompare(t.name)).map(a=>({value:a.id,label:a.name}))],I=g.find(a=>a.value===P)||{value:"all",label:"All Suppliers"};return r($,{children:[e(E,{title:"History"}),r(L,{children:[e("h3",{className:"text-2xl mt-10 mb-4 font-semibold text-fourth",children:"Rekap Transaksi"}),e("div",{className:"flex  flex-wrap justify-between w-full item-center mt-2",children:e(z,{href:route("admin.dashboard")})}),r("div",{className:"flex  flex-wrap justify-between w-full item-center my-2",children:[r("div",{className:"flex items-center flex-wrap sm:flex-nowrap gap-2 w-full mb-2 md:mb-0 sm:w-full md:w-1/2",children:[r("div",{className:"w-full flex gap-2",children:[r("div",{className:"w-full",children:[e(C,{type:"date",name:"start_date",id:"start_date",className:"w-full",onChange:w,value:d.start_date}),u.start_date?e("span",{className:"text-red-500",children:u.start_date}):null]}),r("div",{className:"w-full",children:[e(C,{type:"date",name:"end_date",id:"end_date",className:"w-full",onChange:w,value:d.end_date}),u.end_date?e("span",{className:"text-red-500",children:u.end_date}):null]})]}),r("div",{className:"w-full sm:w-auto flex gap-2 justify-end sm:justify-start",children:[e(b,{className:"w-10 h-10 bg-violet",onClick:D,type:"button",disabled:!d.start_date||!d.end_date,children:e(Y,{size:26})}),e(b,{className:"w-10 h-10",onClick:()=>O(h),type:"button",disabled:!S,children:e(G,{size:26})})]})]}),e(M,{id:"supplier-select",value:I,options:g,className:"w-full lg:w-1/4",onChange:B,styles:{control:(a,t)=>({...a,border:(t.isFocused,"2px solid #d4d4d8"),boxShadow:"none","&:hover":{border:"2px solid #d4d4d8"},height:"44px",borderRadius:"8px"}),option:(a,t)=>({...a,backgroundColor:t.isSelected||t.isFocused?"#d4d4d8":null,color:"black"}),menu:a=>({...a,borderRadius:"8px"}),menuList:a=>({...a,borderRadius:"8px"})},theme:a=>({...a,borderRadius:8,colors:{...a.colors,primary25:"#d4d4d8",primary:"black"}})})]}),e("div",{className:"w-full"}),r("table",{className:"min-w-full divide-y divide-gray-200",children:[r("thead",{className:"bg-gray-50",children:[r("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nama Penitip"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nama Produk"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Harga Produk Satuan"}),e("th",{colSpan:"2",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jumlah Pendapatan"}),e("th",{colSpan:"2",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jumlah Transaksi"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Omset"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Komisi 10%"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Qris - Komisi"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Omset Bersih"})]}),r("tr",{children:[e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3",children:"Cash"}),e("th",{className:"px-6 py-3",children:"Qris"}),e("th",{className:"px-6 py-3",children:"Cash"}),e("th",{className:"px-6 py-3",children:"Qris"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"}),e("th",{className:"px-6 py-3"})]})]}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(_).map(([a,t],l)=>{const m=t.price*t.totalTransactionsCash+t.price*t.totalTransactionsQris,n=(t.price*t.totalTransactionsCash+t.price*t.totalTransactionsQris)*.1,i=t.price*t.totalTransactionsQris-n;return r("tr",{children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:l+1}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:t.supplierName}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.price)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.price*t.totalTransactionsCash)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.price*t.totalTransactionsQris)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.totalTransactionsCash)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.totalTransactionsQris)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(m)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(n)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(i)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s(t.totalOmsetBersih)})]},l)})})]}),r("div",{className:"flex flex-wrap gap-3",children:[r("div",{className:"w-full flex gap-3",children:[r("p",{className:"text-sm text-third",children:["Total Rekap:"," ",e("span",{className:"font-bold",children:s(p)})," "]}),r("p",{className:"text-sm text-third",children:["Total Qris:"," ",e("span",{className:"font-bold",children:s(x)})," "]}),r("p",{className:"text-sm text-third",children:["Total Cash:"," ",e("span",{className:"font-bold",children:s(N)})," "]})]}),r("div",{className:"w-full flex gap-3",children:[r("p",{className:"text-sm text-third",children:["Total Komisi:"," ",e("span",{className:"font-bold",children:s(p/10)})," "]}),r("p",{className:"text-sm text-third",children:["Total Qris Bersih:"," ",e("span",{className:"font-bold",children:s(x-p/10)})," "]})]})]})]})]})}U.layout=h=>e(H,{children:h});export{U as default};
